:root {
    --app-viewport-height: 100vh;
}

@supports (height: 100dvh) {
    :root {
        --app-viewport-height: 100dvh;
    }
}

body {
    background: linear-gradient(180deg, #cde8ff 0%, #fef6dc 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: 'M PLUS Rounded 1c', 'DotGothic16', monospace;
    color: #35524f;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.app-container {
    width: clamp(320px, 90vmin, 600px);
    height: clamp(560px, var(--app-viewport-height), 800px);
    position: relative;
    border: 4px solid #7cbf94;
    border-radius: 18px;
    box-shadow: 0 18px 40px rgba(74, 114, 90, 0.25);
    overflow: hidden;
    background-image: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(236, 252, 244, 0.92) 100%);
}

.game-screen {
    width: 100%;
    height: 100%;
    display: none;
    flex-direction: column;
    justify-content: flex-end; /* メッセージボックスが下に来るように */
    align-items: center;
    position: absolute;
    top: 0;
    left: 0;
    padding: 20px;
    box-sizing: border-box;
    background-size: cover;
    background-position: center;
    overflow-y: auto;
    transition: opacity 0.5s ease;
    opacity: 0;
}

.game-screen.active {
    display: flex;
    opacity: 1;
}

.background-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    z-index: 1;
    transition: background-image 0.5s ease;
    opacity: 0.85;
}

#hero-chair-container {
    position: absolute;
    top: 20px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 40px;
    z-index: 7;
    pointer-events: none;
}

.scene-sprite {
    width: clamp(64px, 18vmin, 90px);
    height: clamp(64px, 18vmin, 90px);
    background-repeat: no-repeat;
    background-size: contain;
    image-rendering: pixelated;
}

.scene-sprite.hero {
    background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%2080%2080%27%3E%0A%20%20%3Crect%20width%3D%2780%27%20height%3D%2780%27%20fill%3D%27none%27%2F%3E%0A%20%20%3Ccircle%20cx%3D%2740%27%20cy%3D%2720%27%20r%3D%2712%27%20fill%3D%27%23f6d7b0%27%2F%3E%0A%20%20%3Crect%20x%3D%2728%27%20y%3D%2732%27%20width%3D%2724%27%20height%3D%2726%27%20rx%3D%276%27%20fill%3D%27%232f6bff%27%2F%3E%0A%20%20%3Crect%20x%3D%2720%27%20y%3D%2732%27%20width%3D%2712%27%20height%3D%2724%27%20fill%3D%27%231841b5%27%2F%3E%0A%20%20%3Crect%20x%3D%2748%27%20y%3D%2732%27%20width%3D%2712%27%20height%3D%2724%27%20fill%3D%27%231841b5%27%2F%3E%0A%20%20%3Crect%20x%3D%2730%27%20y%3D%2758%27%20width%3D%278%27%20height%3D%2716%27%20fill%3D%27%23472615%27%2F%3E%0A%20%20%3Crect%20x%3D%2742%27%20y%3D%2758%27%20width%3D%278%27%20height%3D%2716%27%20fill%3D%27%23472615%27%2F%3E%0A%20%20%3Crect%20x%3D%2726%27%20y%3D%2712%27%20width%3D%2728%27%20height%3D%2712%27%20fill%3D%27%23c92034%27%2F%3E%0A%20%20%3Crect%20x%3D%2728%27%20y%3D%2712%27%20width%3D%2724%27%20height%3D%278%27%20fill%3D%27%23efb700%27%2F%3E%0A%20%20%3Crect%20x%3D%2712%27%20y%3D%2740%27%20width%3D%2712%27%20height%3D%278%27%20fill%3D%27%23f6d7b0%27%2F%3E%0A%20%20%3Crect%20x%3D%2756%27%20y%3D%2740%27%20width%3D%2712%27%20height%3D%278%27%20fill%3D%27%23f6d7b0%27%2F%3E%0A%3C%2Fsvg%3E");
}

.scene-sprite.chair {
    background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%2080%2080%27%3E%0A%20%20%3Crect%20width%3D%2780%27%20height%3D%2780%27%20fill%3D%27none%27%2F%3E%0A%20%20%3Crect%20x%3D%2718%27%20y%3D%2732%27%20width%3D%2744%27%20height%3D%2714%27%20rx%3D%274%27%20fill%3D%27%23c97835%27%2F%3E%0A%20%20%3Crect%20x%3D%2722%27%20y%3D%2724%27%20width%3D%2736%27%20height%3D%2712%27%20rx%3D%274%27%20fill%3D%27%238b5122%27%2F%3E%0A%20%20%3Crect%20x%3D%2718%27%20y%3D%2746%27%20width%3D%2744%27%20height%3D%2710%27%20rx%3D%273%27%20fill%3D%27%239e5d28%27%2F%3E%0A%20%20%3Crect%20x%3D%2720%27%20y%3D%2756%27%20width%3D%278%27%20height%3D%2718%27%20fill%3D%27%235f3818%27%2F%3E%0A%20%20%3Crect%20x%3D%2752%27%20y%3D%2756%27%20width%3D%278%27%20height%3D%2718%27%20fill%3D%27%235f3818%27%2F%3E%0A%20%20%3Crect%20x%3D%2714%27%20y%3D%2726%27%20width%3D%276%27%20height%3D%2726%27%20fill%3D%27%235f3818%27%2F%3E%0A%20%20%3Crect%20x%3D%2760%27%20y%3D%2726%27%20width%3D%276%27%20height%3D%2726%27%20fill%3D%27%235f3818%27%2F%3E%0A%3C%2Fsvg%3E");
}

#hero-sprite.animate {
    animation: hero-slide 0.9s ease-in-out;
}

#chair-sprite.animate {
    animation: chair-slide 0.9s ease-in-out;
}

@keyframes hero-slide {
    0% { transform: translateX(-20px) translateY(0); }
    40% { transform: translateX(0) translateY(-10px); }
    70% { transform: translateX(18px) translateY(-4px); }
    100% { transform: translateX(0) translateY(0); }
}

@keyframes chair-slide {
    0% { transform: translateX(20px) translateY(0); }
    40% { transform: translateX(0) translateY(-8px); }
    70% { transform: translateX(-16px) translateY(-2px); }
    100% { transform: translateX(0) translateY(0); }
}

#character-sprite-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: calc(100% - 200px); /* メッセージボックスの高さ分を引く */
    display: flex;
    justify-content: center;
    align-items: flex-end; /* 下部に配置 */
    z-index: 5;
    pointer-events: none; /* キャラクターをクリックできないように */
}

.message-box {
    width: 95%;
    min-height: 150px;
    background-color: rgba(255, 255, 255, 0.92);
    border: 3px solid #7cbf94;
    border-radius: 14px;
    box-shadow: 0 12px 28px rgba(60, 96, 82, 0.25);
    padding: 18px;
    box-sizing: border-box;
    z-index: 10;
    position: relative;
    margin-bottom: 20px;
}

.message-text {
    margin: 0;
    font-size: clamp(14px, 4vw, 24px);
    line-height: 1.5;
    white-space: pre-wrap;
    color: inherit;
}

.choice-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 15px;
}

.choice-button {
    background-color: rgba(255, 255, 255, 0.88);
    color: #35524f;
    border: 2px solid #7cbf94;
    border-radius: 999px;
    padding: 10px 18px;
    font-family: 'M PLUS Rounded 1c', 'DotGothic16', monospace;
    font-size: clamp(12px, 3.5vw, 20px);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
    box-shadow: 0 8px 16px rgba(124, 191, 148, 0.2);
}

.choice-button:hover,
.choice-button:focus-visible {
    background-color: #7cbf94;
    color: #fff;
    box-shadow: 0 10px 24px rgba(124, 191, 148, 0.35);
    transform: translateY(-2px);
    outline: none;
}

.choice-button:active {
    transform: translateY(0);
    box-shadow: 0 4px 12px rgba(53, 82, 79, 0.25);
}

/* スプライト共通スタイル */
.sprite {
    position: absolute; /* character-sprite-container内での位置決め */
    background-size: contain;
    background-repeat: no-repeat;
    image-rendering: pixelated;
    bottom: 20px; /* メッセージボックスの上に配置 */
    left: 50%;
    transform: translateX(-50%);
    filter: drop-shadow(0 6px 12px rgba(53, 82, 79, 0.25));
}

/* キャラクターごとのスタイル */
.sprite.tanuki {
    width: 110px;
    height: 110px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwIDEwKSI+PHJlY3QgeD0iMjgiIHk9IjQiIHdpZHRoPSI0NCIgaGVpZ2h0PSIyOCIgcng9IjE0IiBmaWxsPSIjOGM1ZTNjIi8+PGVsbGlwc2UgY3g9IjUwIiBjeT0iNDIiIHJ4PSI0NiIgcnk9IjQ0IiBmaWxsPSIjYTk3NDRhIi8+PGVsbGlwc2UgY3g9IjUwIiBjeT0iNjAiIHJ4PSI0MCIgcnk9IjMyIiBmaWxsPSIjYzI4YzU0Ii8+PGNpcmNsZSBjeD0iMzQiIGN5PSI0NCIgcj0iMTAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSI2NiIgY3k9IjQ0IiByPSIxMCIgZmlsbD0iI2ZmZiIvPjxjaXJjbGUgY3g9IjM0IiBjeT0iNDQiIHI9IjYiIGZpbGw9IiM0YjJiMWIiLz48Y2lyY2xlIGN4PSI2NiIgY3k9IjQ0IiByPSI2IiBmaWxsPSIjNGIyYjFiIi8+PHBhdGggZD0iTTM0IDc0IFE1MCA4NiA2NiA3NCIgc3Ryb2tlPSIjNGIyYjFiIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik01MCAyMCBRNTggMzQgNzAgMjYiIHN0cm9rZT0iIzQwMjMxMiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiLz48cGF0aCBkPSJNNTAgMjAgUTQyIDM0IDMwIDI2IiBzdHJva2U9IiM0MDIzMTIiIHN0cm9rZS13aWR0aD0iNiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBmaWxsPSJub25lIi8+PGVsbGlwc2UgY3g9IjE4IiBjeT0iNjQiIHJ4PSIxMiIgcnk9IjE2IiBmaWxsPSIjN2E1MDM0Ii8+PGVsbGlwc2UgY3g9IjgyIiBjeT0iNjQiIHJ4PSIxMiIgcnk9IjE2IiBmaWxsPSIjN2E1MDM0Ii8+PC9nPjwvc3ZnPg==');
}

.sprite.dog {
    width: 100px;
    height: 100px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyIDEyKSI+PGVsbGlwc2UgY3g9IjQ4IiBjeT0iMzYiIHJ4PSIyNCIgcnk9IjIyIiBmaWxsPSIjZjdkOWE4Ii8+PGVsbGlwc2UgY3g9IjQ4IiBjeT0iNjYiIHJ4PSIzNCIgcnk9IjM2IiBmaWxsPSIjZmZlNGM3Ii8+PGNpcmNsZSBjeD0iMzQiIGN5PSIzOCIgcj0iNiIgZmlsbD0iIzNhMmYyOSIvPjxjaXJjbGUgY3g9IjYyIiBjeT0iMzgiIHI9IjYiIGZpbGw9IiMzYTJmMjkiLz48cGF0aCBkPSJNNDAgNTYgUTQ4IDY0IDU2IDU2IiBmaWxsPSIjZjdkOWE4Ii8+PHBhdGggZD0iTTQwIDU2IFE0OCA1MCA1NiA1NiIgc3Ryb2tlPSIjM2EyZjI5IiBzdHJva2Utd2lkdGg9IjQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjU4IiByeD0iMTAiIHJ5PSIxNCIgZmlsbD0iI2Q1YjQ4YSIvPjxlbGxpcHNlIGN4PSI3NiIgY3k9IjU4IiByeD0iMTAiIHJ5PSIxNCIgZmlsbD0iI2Q1YjQ4YSIvPjxwYXRoIGQ9Ik0zMCAyNiBxLTEyIDEyIDAgMjQiIGZpbGw9IiNkNWI0OGEiLz48cGF0aCBkPSJNNjYgMjYgcTEyIDEyIDAgMjQiIGZpbGw9IiNkNWI0OGEiLz48Y2lyY2xlIGN4PSI0OCIgY3k9IjQ2IiByPSI2IiBmaWxsPSIjM2EyZjI5Ii8+PC9nPjwvc3ZnPg==');
}

.sprite.cat {
    width: 96px;
    height: 96px;
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIj48cmVjdCB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgZmlsbD0ibm9uZSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyIDEwKSI+PGVsbGlwc2UgY3g9IjQ4IiBjeT0iMzgiIHJ4PSIyMiIgcnk9IjIwIiBmaWxsPSIjZjVjNmQzIi8+PGVsbGlwc2UgY3g9IjQ4IiBjeT0iNjgiIHJ4PSIzNCIgcnk9IjM2IiBmaWxsPSIjZmZkOWU2Ii8+PGNpcmNsZSBjeD0iMzYiIGN5PSI0MCIgcj0iNyIgZmlsbD0iIzJmMjEzMCIvPjxjaXJjbGUgY3g9IjYwIiBjeT0iNDAiIHI9IjciIGZpbGw9IiMyZjIxMzAiLz48cGF0aCBkPSJNNDAgNjIgUTQ4IDcwIDU2IDYyIiBzdHJva2U9IiMyZjIxMzAiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTMyIDI2IGwtMTQgMTQgMTggLTYgZXoiIGZpbGw9IiNmNWM2ZDMiLz48cGF0aCBkPSJNNjQgMjYgbDE0IDE0IC0xOCAtNiB6IiBmaWxsPSIjZjVjNmQzIi8+PHBhdGggZD0iTTQ4IDUyIGwtOCA2IDggNCA4IC00eiIgZmlsbD0iI2ZmZWRmMyIgc3Ryb2tlPSIjMmYyMTMwIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48ZWxsaXBzZSBjeD0iMTgiIGN5PSI2NiIgcng9IjEwIiByeT0iMTQiIGZpbGw9IiNmNWM2ZDMiLz48ZWxsaXBzZSBjeD0iNzgiIGN5PSI2NiIgcng9IjEwIiByeT0iMTQiIGZpbGw9IiNmNWM2ZDMiLz48L2c+PC9zdmc+');
}

/* スタート画面のキャラクターの位置 */
.sprite.start-character {
    top: 24%;
    left: 50%;
    transform: translateX(-50%);
}


.title {
    font-size: clamp(26px, 6vw, 44px);
    text-shadow: 0 6px 18px rgba(53, 82, 79, 0.25);
    text-align: center;
    margin-top: 40px;
    margin-bottom: 20px;
    color: #2f6159;
    letter-spacing: 0.04em;
}

#result-screen {
    justify-content: center;
    text-align: center;
    background-image: none;
    background: linear-gradient(180deg, rgba(205, 232, 255, 0.9) 0%, rgba(242, 250, 230, 0.9) 100%);
}

#start-screen {
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NDAiIGhlaWdodD0iNjQwIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9InNreSIgeDE9IjAiIHkxPSIwIiB4Mj0iMCIgeTI9IjEiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNiZGU4ZmYiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmZGY2ZWMiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JvdW5kIiB4MT0iMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzllZGJiNyIvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzZiYmQ4YSIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSI2NDAiIGhlaWdodD0iNDAwIiBmaWxsPSJ1cmwoI3NreSkiLz48cmVjdCB5PSIzNjAiIHdpZHRoPSI2NDAiIGhlaWdodD0iMjgwIiBmaWxsPSJ1cmwoI2dyb3VuZCkiLz48cGF0aCBkPSJNMCAzNjAgUTE2MCAzMjAgMzIwIDM2MCBUNjQwIDM2MCBWNDAwIEgwIFoiIGZpbGw9IiNmN2Q5YTciIG9wYWNpdHk9IjAuNiIvPjxnIG9wYWNpdHk9IjAuNSI+PGNpcmNsZSBjeD0iMTIwIiBjeT0iNDQwIiByPSI5MCIgZmlsbD0iI2ZmZiIvPjxjaXJjbGUgY3g9IjIyMCIgY3k9IjQzMCIgcj0iNzAiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSI1MjAiIGN5PSI0NTAiIHI9IjEyMCIgZmlsbD0iI2ZmZiIvPjwvZz48ZyBvcGFjaXR5PSIwLjgiPjxwYXRoIGQ9Ik0zNDAgMzYwIGw0MCAtNjAgNDAgNjAgeiIgZmlsbD0iIzllZGJiNyIvPjxwYXRoIGQ9Ik00MjAgMzYwIGwzNSAtNTAgMzUgNTAgeiIgZmlsbD0iIzhhY2U5ZSIvPjxwYXRoIGQ9Ik00ODAgMzYwIGwzMCAtNDUgMzAgNDUgeiIgZmlsbD0iIzdlYzU5MCIvPjwvZz48Y2lyY2xlIGN4PSI4MCIgY3k9IjEyMCIgcj0iNDAiIGZpbGw9IiNmZmY3YzIiIG9wYWNpdHk9IjAuNyIvPjwvc3ZnPg==');
    background-size: cover;
    background-position: center;
}

.result-box {
    background-color: rgba(255, 255, 255, 0.92);
    border: 3px solid #7cbf94;
    border-radius: 16px;
    box-shadow: 0 12px 28px rgba(74, 114, 90, 0.25);
    padding: 20px;
    width: 90%;
    max-width: 400px;
    margin-bottom: 20px;
}

.chair-image {
    width: 100%;
    height: auto;
    border: 2px solid #7cbf94;
    margin-bottom: 10px;
}

.result-details {
    text-align: left;
}
.result-text {
    font-size: clamp(14px, 3.5vw, 20px);
    margin: 5px 0;
    color: #35524f;
}

.ar-container {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    width: 90%;
    max-width: 420px;
    margin-bottom: 20px;
    z-index: 10;
}

.ar-viewer {
    width: 100%;
    min-height: 260px;
    border: 3px solid #7cbf94;
    border-radius: 14px;
    overflow: hidden;
    background: rgba(236, 252, 244, 0.85);
    box-shadow: 0 12px 24px rgba(74, 114, 90, 0.2);
}

.ar-button {
    margin: 12px auto 0 auto;
    background-color: #7cbf94;
    color: #fff;
}

.ar-button:hover {
    background-color: #5fae7e;
    color: #fff;
}

.ar-description {
    font-size: clamp(12px, 3vw, 16px);
    margin: 0;
    text-align: center;
    line-height: 1.6;
    color: #35524f;
}

.purchase-button {
    width: 100%;
    text-align: center;
    text-decoration: none;
    box-sizing: border-box;
    background-color: #ffe3a1;
    border-color: #f4c979;
    color: #4c3b15;
}

.purchase-button:hover,
.purchase-button:focus-visible {
    background-color: #f4c979;
    color: #4c3b15;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.blink-dot {
    animation: blink 1s infinite;
}

/* キャラクターの軽い動き */
@keyframes walking {
    0% { transform: translateX(-50%) translateY(0px); }
    50% { transform: translateX(-50%) translateY(-5px); }
    100% { transform: translateX(-50%) translateY(0px); }
}

.sprite.walking {
    animation: walking 2s infinite ease-in-out;
}